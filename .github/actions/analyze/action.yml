name: ğŸ” Code Quality Metrics
description: "ğŸ“Š Runs Dart Code Metrics analysis across all modules"

runs:
  using: composite
  steps:
    - name: ğŸ› ï¸ Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: stable
        cache: true

    - name: ğŸ§© Setup Melos
      uses: bluefireteam/melos-action@v2

    - name: ğŸ“¦ Install Dependencies
      shell: bash
      run: melos bootstrap

    - name: ğŸ“ Run Code Metrics
      shell: bash
      run: |
        mkdir -p metrics/html
        chmod +x scripts/run-code-metrics.sh
        ./scripts/run-code-metrics.sh \
          "lib"

    - name: ğŸ“¦ Package Reports
      shell: bash
      run: |
        mkdir -p metrics_archive
        zip -qr "metrics_archive/code-metrics-$(date +%Y%m%d).zip" metrics

    - name: ğŸ“¤ Upload Metrics Report
      uses: actions/upload-artifact@v4
      with:
        name: code-metrics
        path: metrics_archive/*.zip